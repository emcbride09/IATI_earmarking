require(googlesheets)
require(tidyverse)
gs_auth(new_user = TRUE)
mysheets <- gs_ls()
mysheets <- gs_ls()
iati_em <- gs_ls("IATI_earmarking")
View(iati_em)
load("C:/Users/EMCB-PC/Desktop/rdir/Projects/HDX/team_map/.RData")
iati_em <- gs_read(ss= IATI_earmarking, ws = Sheet1)
require(googlesheets)
require(tidyverse)
iati_em <- gs_read(ss= IATI_earmarking, ws = Sheet1)
iati_em <- gs_read(ss= "IATI_earmarking", ws = "Sheet1")
require(googlesheets)
require(tidyverse)
gs_auth(new_user = TRUE)
mysheets <- gs_ls()
gs_auth(new_user = TRUE)
mysheets <- gs_ls()
iati_em <- gs_title("IATI_earmarking")
n <- iati_em %>% gs_read(ws = "Sheet1")
n <- n %>% rename(et = `Earmarking Type`,
ot = `Org Type`,
ta = `Total Amount`,
year = Year,
at = `Annual Total`)
n$at <- as.numeric(n$at)
plot1 <- n %>% ggplot(aes(x = ot, y = at, fill = et)) +
geom_col(aes(at)) +
facet_grid(cols = vars(year))
plot1
plot2 <- ggplot(n) + scale_y_continuous(limits = c(0, ylim), breaks = NA)
plot2
plot3 <- plot2 + geom_bar(aes(ot, at), stat = 'identity') +
geom_bar(aes(ot, ta, fill = et), stat = 'identity', position = 'dodge')
plot3
iati_em <- gs_title("IATI_earmarking")
n <- iati_em %>% gs_read(ws = "Sheet1")
n <- n %>% rename(et = `Earmarking Type`,
ot = `Org Type`,
ta = `Total Amount`,
year = Year,
at = `Annual Total`)
n$at <- as.numeric(n$at)
plot1 <- n %>% ggplot(aes(x = ot, y = at, fill = et)) +
geom_col(aes(at)) +
facet_grid(cols = vars(year))
plot1
plot2 <- ggplot(n) + scale_y_continuous(limits = c(0, ylim), breaks = NA)
plot2
plot3 <- plot2 + geom_bar(aes(ot, at), stat = 'identity') +
geom_bar(aes(ot, ta, fill = et), stat = 'identity', position = 'dodge')
plot3
> df <- read.csv(textConnection("
+ Segment,Alpha,Beta,Gamma,Delta
+ A,1416649,590270,236108,118054
+ B,708325,531243,354162,177081
+ C,354162,354162,236108,236108
+ D,147568,147568,147568,147568"))
> df <- read.csv(textConnection("+ Segment,Alpha,Beta,Gamma,Delta
+ A,1416649,590270,236108,118054
+ B,708325,531243,354162,177081
+ C,354162,354162,236108,236108
+ D,147568,147568,147568,147568"))
> closeAllConnections()
n <- n %>% rename(earmarkingtype = `Earmarking Type`,
orgttype = `Org Type`,
totalamount = `Total Amount`,
year = Year,
annualtotal = `Annual Total`)
iati_em <- gs_title("IATI_earmarking")
n <- iati_em %>% gs_read(ws = "Sheet1")
n <- n %>% rename(earmarkingtype = `Earmarking Type`,
orgttype = `Org Type`,
totalamount = `Total Amount`,
year = Year,
annualtotal = `Annual Total`)
n$annualtotal <- as.numeric(n$annualtotal)
n$totalamount <- as.numeric(n$totalamount)
?cast
ylim <- max(cast(dfa, earmarkingtype ~ ., sum)[, 2],
+     cast(dfa, Segment ~ ., sum)[, 2])
library(scales)
df <- data_frame(bucket=sprintf("Bucket %s", LETTERS[1:5]),
budgeted=c(140, 125, 125, 100, 100),
actual=c(150, 140, 115, 90, 115))
View(df)
df <- mutate(df, bucket=factor(bucket, levels=rev(bucket)))
View(df)
gg <- ggplot(data=df, aes(y=bucket, yend=bucket))
gg <- gg + geom_segment(aes(x=budgeted, xend=0, color="Budgeted"), size=10)
gg <- gg + geom_segment(aes(x=actual, xend=0, color="Actual"), size=5)
gg <- gg + scale_x_continuous(expand=c(0,0), limits=c(0, 160),
breaks=seq(0, 160, 20), label=dollar)
gg <- gg + scale_color_manual(name=NULL, values=c(Budgeted="#bebebf", Actual="#1074bc"))
gg <- gg + guides(color=guide_legend(keywidth=0, override.aes=list(size=4)))
gg <- gg + labs(x=NULL, y=NULL,
title="The budget surplus from Buckets A, B, & E\ncompensates for the shortfall in Buckets C & D",
caption="Source: http://stephanieevergreen.com/overlapping-bars/")
gg <- gg + theme_minimal(base_family="Arial Narrow")
gg <- gg + theme(axis.text.x=element_text(margin=margin(t=-10)))
gg <- gg + theme(axis.text.y=element_text(margin=margin(r=-10)))
gg <- gg + theme(panel.grid.minor=element_blank())
gg <- gg + theme(panel.grid.major.y=element_blank())
gg <- gg + theme(plot.title=element_text(face="bold"))
gg <- gg + theme(plot.margin=margin(20,20,20,20))
gg <- gg + theme(plot.caption=element_text(size=8, margin=margin(t=10, r=0)))
gg <- gg + theme(legend.position=c(0.875, 0.3))
gg <- gg + theme(legend.direction="horizontal")
gg
gg <- gg + theme(legend.background=element_rect(fill="white", color="white"))
gg
n$orgttype <- as.factor(n$orgttype)
n$earmarkingtype <- as.factor(n$earmarkingtype)
View(n)
n <- n %>% rename(earmarkingtype = `Earmarking Type`,
orgttype = `Org Type`,
emamount = `Total Amount`,
year = Year,
annualtotal = `Annual Total`)
n <- iati_em %>% gs_read(ws = "Sheet1")
n <- n %>% rename(earmarkingtype = `Earmarking Type`,
orgttype = `Org Type`,
emamount = `Total Amount`,
year = Year,
annualtotal = `Annual Total`)
n$annualtotal <- as.numeric(n$annualtotal)
n$emamount <- as.numeric(n$emamount)
n$orgttype <- as.factor(n$orgttype)
n$earmarkingtype <- as.factor(n$earmarkingtype)
plot1 <- ggplot(n, aes(y = orgttype, yend = orgtype))
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color=earmarkingtype), size = 10)
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "earmarkingtype"), size = 10)
gm <- plot2 + geom_abline(aes(x = emamount, xend = 0, color = "Earmarked Amount"), size = 5)
gm <- plot2 + geom_abline(aes(x = emamount, xend=0, color = "Earmarked Amount"), size = 5)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = "Earmarked Amount"), size = 5)
gm
plot1 <- ggplot(n, aes(y = orgttype, yend = orgttype))
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "earmarkingtype"), size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = "Earmarked Amount"), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget"), size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = "Earmarked Amount"), size = 5)
gm
gm
gm + facet_wrap(~. year)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = "Earmarked Amount", fill = earmarkingtype), size = 5)
gm <- plot2 + geom_segment(aes(x = earmarking, xend=0, color = "Earmarked Amount"), size = 5)
gm + facet_wrap(~. year)
gm
gm <- plot2 + geom_segment(aes(x = earmarkingtype, xend=0, color = "Earmarked Amount"), size = 5)
gm
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, y = earmarkingtype, color = "Earmarked Amount"), size = 5)
gm
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget", alpha(0.5)), size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget", alpha = 0.5), size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget")alpha = 0.5, size = 10)
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget"), alpha = 0.5, size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget", alpha = 0.2), size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget", alpha = 0.01), size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget"), alpha = 0.01, size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget"), alpha = 0.08, size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget"), alpha = 0.5, size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget"), alpha = 0.1, size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm
gm + facet_grid(cols = vars(year))
gm + facet_grid(rows = vars(year))
plot1 <- ggplot(n, aes(x = orgttype, xend = orgttype))
plot2 <- plot1 + geom_segment(aes(x = annualtotal, xend=0, color= "Total budget"), alpha = 0.1, size = 10)
gm <- plot2 + geom_segment(aes(x = emamount, xend=0, color = earmarkingtype), size = 5)
gm + facet_grid(rows = vars(year))
plot1 <- ggplot(n, aes(x = orgttype, xend = orgttype))
plot2 <- plot1 + geom_segment(aes(y = annualtotal, yend=0, color= "Total budget"), alpha = 0.1, size = 10)
gm <- plot2 + geom_segment(aes(y = emamount, yend=0, color = earmarkingtype), size = 5)
gm + facet_grid(rows = vars(year))
gm + facet_grid(cols = vars(year))
gm + facet_grid(cols = vars(year)) +geom_smooth()
gm + facet_grid(cols = vars(year)) +geom_smooth(aes(y = annualtotal))
iati_plot_base <- gm + facet_grid(cols = vars(year))
iati_plot_base <- gm + facet_grid(cols = vars(year))
iati_plot_base + theme(text(axis.text.x(angle = 45)))
iati_plot_base + theme(axis.text.x = element.text(angle = 45))
iati_plot_base + theme(axis.text.x = element_text(angle = 45))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.5))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.05))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.005))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.005))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = 1))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = 2))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.01))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.001))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.001))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.000001))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.5))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = -0.1))
iati_plot_base + theme(axis.text.x = element_text(angle = 45, vjust = 0))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.2))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.4))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.5))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 0.2))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = 0.2))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = -0.2))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = 0))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = 0.1))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = 0.1))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = 0.3))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = 0.6))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.3, hjust = 0.6))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.4, hjust = 0.6))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 0.6))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 0.7))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.6, hjust = 0.7))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.7, hjust = 0.7))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.8, hjust = 0.7))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 0.9, hjust = 0.7))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 0.7))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 0.6))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 0.8))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
plot2 <- plot1 + geom_segment(aes(y = annualtotal, yend=0, color= "Total budget"), alpha = 0.1, size = 14)
gm <- plot2 + geom_segment(aes(y = emamount, yend=0, color = earmarkingtype), size = 5)
iati_plot_base <- gm + facet_grid(cols = vars(year))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
#gg <- ggplot(data=df, aes(y=bucket, yend=bucket))
option( scipen = -10 )
load("C:/Users/EMCB-PC/Desktop/rdir/Projects/HDX/AEWG/first_aewg/.RData")
#gg <- ggplot(data=df, aes(y=bucket, yend=bucket))
options(scipen = -10 )
plot1 <- ggplot(n, aes(x = orgttype, xend = orgttype))
plot2 <- plot1 + geom_segment(aes(y = annualtotal, yend=0, color= "Total budget"), alpha = 0.1, size = 14)
require(googlesheets)
require(tidyverse)
library(scales)
#gg <- ggplot(data=df, aes(y=bucket, yend=bucket))
options(scipen = -10 )
plot1 <- ggplot(n, aes(x = orgttype, xend = orgttype))
plot2 <- plot1 + geom_segment(aes(y = annualtotal, yend=0, color= "Total budget"), alpha = 0.1, size = 14)
gs_auth(new_user = TRUE)
mysheets <- gs_ls()
iati_em <- gs_title("IATI_earmarking")
n <- iati_em %>% gs_read(ws = "Sheet1")
n <- n %>% rename(earmarkingtype = `Earmarking Type`,
orgttype = `Org Type`,
emamount = `Total Amount`,
year = Year,
annualtotal = `Annual Total`)
n$annualtotal <- as.numeric(n$annualtotal)
n$emamount <- as.numeric(n$emamount)
n$orgttype <- as.factor(n$orgttype)
n$earmarkingtype <- as.factor(n$earmarkingtype)
#using code from https://gist.github.com/hrbrmstr/035f998517de2384e9962cff7df874bd
#gg <- ggplot(data=df, aes(y=bucket, yend=bucket))
options(scipen = -10 )
plot1 <- ggplot(n, aes(x = orgttype, xend = orgttype))
#gg <- gg + geom_segment(aes(x=budgeted, xend=0, color="Budgeted"), size=10)
plot2 <- plot1 + geom_segment(aes(y = annualtotal, yend=0, color= "Total budget"), alpha = 0.1, size = 14)
#gg <- gg + geom_segment(aes(x=actual, xend=0, color="Actual"), size=5)
gm <- plot2 + geom_segment(aes(y = emamount, yend=0, color = earmarkingtype), size = 5)
iati_plot_base <- gm + facet_grid(cols = vars(year))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
#gg <- ggplot(data=df, aes(y=bucket, yend=bucket))
options(scipen = -10 )
plot1 <- ggplot(n, aes(x = orgttype, xend = orgttype))
plot2 <- plot1 + geom_segment(aes(y = annualtotal, yend=0, color= "Total budget"), alpha = 0.1, size = 14)
gm <- plot2 + geom_segment(aes(y = emamount, yend=0, color = earmarkingtype), size = 5)
iati_plot_base <- gm + facet_grid(cols = vars(year))
iati_plot_base + theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
iati_plot_base
iati_plot_base <- gm + facet_grid(cols = vars(year))
iati_plot_base
